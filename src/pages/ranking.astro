---
import Layout from '@layouts/App.astro'
import RankingTable from '@components/RankingTable.astro';
import RankingTableNew from '@components/RankingTableNew.astro';
import RelatedNews from '@components/articles/RelatedNews.astro';

import { getMembers, getTournaments, getMatches, getArticles } from '@lib/generalUtils';

const allMembers = await getMembers();
const tournaments = await getTournaments();
const matches = await getMatches();
const articles = await getArticles();

const filterTags = [
  "ranking",
];
console.log("Filter tags:", filterTags);
console.log("Articles:", articles.map(a => ({
  title: a.data.title,
  date: a.data.date,
  tags: a.data.tags,
})));
const filteredArticles = filterTags.length === 0
  ? articles
  : articles.filter(a =>
      Array.isArray(a.data.tags) &&
      a.data.tags.some(t => filterTags.includes(t))
    );

const sortedArticles = filteredArticles.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());


// Opcional: especificar el torneo actual
const currentTournamentId = 3;
---
<Layout title="FFC - Ranking">
  <main class="">
    <!-- <RankingTable members={allMembers} /> -->
    <RankingTableNew
      members={allMembers}
      tournaments={tournaments}
      matches={matches}
      currentTournamentId={currentTournamentId}
    />
    <RelatedNews articles={sortedArticles} max={4} />
  </main>
</Layout>
